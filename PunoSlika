var library = require('users/perkovickarlo5/proba:Library').myModule;

// Use the imported module
//print(myModule.publicFunction());

var roi= library.rois["ciovo"]["geometry"]
var dataset = ee.ImageCollection('COPERNICUS/S3/OLCI')
                  .filterBounds(roi)
                  //.filterDate('2022-07-06', '2022-07-7');
                  .filterDate('2017-02-04', '2017-02-10');

print("broj slika je",dataset.size())
var prva = dataset.first()
print(prva)
// Convert ImageCollection to a List
var imageList = dataset.toList(dataset.size());
// Extract the first, second, and third images
var firstImage = ee.Image(imageList.get(0));
var secondImage = ee.Image(imageList.get(1));
var thirdImage = ee.Image(imageList.get(2));
var stats = prva.reduceRegion({
  // Use ee.Reducer.minMax() to get min and max for each band
  reducer: ee.Reducer.minMax(),
  // Specify the region geometry
  geometry: roi,
  // Optional: Set the scale (pixel resolution) for the analysis
  // scale: 30 // Example scale in meters
});
var stats2 = secondImage.reduceRegion({
  // Use ee.Reducer.minMax() to get min and max for each band
  reducer: ee.Reducer.minMax(),
  // Specify the region geometry
  geometry: roi,
  // Optional: Set the scale (pixel resolution) for the analysis
  // scale: 30 // Example scale in meters
});
var stats3 = thirdImage.reduceRegion({
  // Use ee.Reducer.minMax() to get min and max for each band
  reducer: ee.Reducer.minMax(),
  // Specify the region geometry
  geometry: roi,
  // Optional: Set the scale (pixel resolution) for the analysis
  // scale: 30 // Example scale in meters
});

print("min i max za sve bandove za prvu sliku:", stats)
print("min i max za sve bandove za drugu sliku:", stats2)
print("min i max za sve bandove za trecu sliku:", stats3)

var bandNames = prva.bandNames();
var numBands = bandNames.size();

var calculateNaNPercentage = function(bandName) {
  var band = prva.select([bandName]);
  
  // Calculate total number of pixels
  var totalPixels = band.reduceRegion({
    reducer: ee.Reducer.count(),
    geometry: prva.geometry(),
    scale: 30, // Adjust scale as necessary
    maxPixels: 1e15
  }).get(bandName);
  
  // Mask non-NaN values
  var nanMask = band.mask(band.neq(band));
  
  // Calculate number of NaN pixels
  var nanPixels = nanMask.reduceRegion({
    reducer: ee.Reducer.count(),
    geometry: prva.geometry(),
    scale: 30, // Adjust scale as necessary
    maxPixels: 1e15
  }).get(bandName);
  
  // Calculate percentage of NaN values
  var nanPercentage = ee.Number(nanPixels).divide(totalPixels).multiply(100);
  
  return nanPercentage;
};
var nanPercentages = bandNames.map(calculateNaNPercentage);

// Print the results
print('NaN percentages for each band:', nanPercentages);

// Function to get the image acquisition time and dimensions
var getImageInfo = function(image) {
  // Get the image metadata properties
  var time = image.get('system:time_start');
  var width = ee.Number(image.get('system:width'));
  var height = ee.Number(image.get('system:height'));
  
  // Create a feature to store the metadata
  var info = ee.Feature(null, {
    'time': time,
    'width': width,
    'height': height
  });
  
  return info;
};

// Map the function over the image collection
var imageInfoCollection = dataset.map(getImageInfo);

// Convert to a feature collection and print
var imageInfoFeatures = ee.FeatureCollection(imageInfoCollection);
print(imageInfoFeatures);